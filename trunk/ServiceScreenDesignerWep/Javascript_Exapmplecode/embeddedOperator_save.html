<html> 
<head> 
    <meta http-equiv='Content-Type' content='text/html; charset=ISO-8859-1'> 
	  <title>Your Wrapper</title> 
	<script type='text/javascript'> 
 
	function from(str, sign, sepNr) 
	{	 
		var tmp = new String(Trim(str)); 
		var save = ''; 
		if (sepNr < 1) 
		{ 
			sepNr = 1; 
		} 
		while (tmp.indexOf(sign) != -1 && sepNr > 0) 
		{ 
			save = tmp.substring(tmp.indexOf(sign), tmp.indexOf(sign) 
					+ sign.length); 
			tmp = tmp.substring(tmp.indexOf(sign) + sign.length, tmp.length); 
			sepNr--; 
		} 
		tmp = save + tmp; 
		return tmp; 
	} 
 
	function until(str, sign, sepNr) 
	{ 
		var tmp = new String(Trim(str)); 
		var res = ''; 
		var length = sign.length; 
		if(sepNr < 1) 
		{ 
			sepNr = 1; 
		} 
		while(tmp.indexOf(sign) != -1 && sepNr > 0) 
		{ 
			res += tmp.substring(0, tmp.indexOf(sign) + length); 
		tmp = tmp.substring(tmp.indexOf(sign) + length, tmp.length); 
			sepNr--; 
		} 
		return res; 
	} 
 
	function charsFromTo(str, from, to) 
	{ 
		var tmp = new String(Trim(str)); 
		var res = ''; 
		if(from < 1) 
		{ 
			from = 1; 
		} 
		if(to > tmp.length) 
		{ 
			to = tmp.length; 
		} 
		for(from; from <= to; from++) 
		{ 
			res += charAt(tmp, from); 
		} 
		return res; 
	} 
 
	function charAt(str, index) 
	{ 
		var res = ''; 
		if(index < 1) 
		{ 
			index = 1; 
		} 
		else if(index > str.length) 
		{ 
			index = str.length; 
		} 
		index = index - 1; 
		res = str.charAt(index); 
		return res; 
	} 
 
	function wordsFromTo(str, from, to) 
	{ 
		var tmp = new String(Trim(str)); 
		var res = ''; 
		var _split = tmp.split(' '); 
		var length = _split.length; 
		if(from < 1) 
		{ 
			from = 1; 
		} 
		if(to > length) 
		{ 
			to = length; 
		} 
		for(from; from <= to; from++) 
		{ 
			res =  res + wordAt(str, from) + ' '; 
		} 
		return res; 
	} 
 
	function wordAt(str, nr) 
	{ 
		var res = new String(Trim(str)); 
		var _split = res.split(' '); 
		var length = _split.length; 
		nr = nr -1; 
		if(nr < 0 || nr >= length) 
		{ 
			nr = length-1; 
		} 
		res = _split[nr]; 
		return res; 
	} 
 
	function Trim(str) 
	{ 
		return RTrim(LTrim(str)); 
	} 
	function LTrim(str) 
	{ 
		var whitespace = new String(' '); 
		var s = new String(str); 
		if (whitespace.indexOf(s.charAt(0)) != -1) 
		{ 
			var j=0, i = s.length; 
			while (j < i && whitespace.indexOf(s.charAt(j)) != -1) 
				j++; 
			s = s.substring(j, i); 
		} 
		return s; 
	} 
 
	function RTrim(str) 
	{ 
		var whitespace = new String(' '); 
		var s = new String(str); 
		if (whitespace.indexOf(s.charAt(s.length-1)) != -1) 
		{ 
			var i = s.length - 1; 
			while (i >= 0 && whitespace.indexOf(s.charAt(i)) != -1) 
				i--; 
			s = s.substring(0, i+1); 
		} 
		return s; 
	} 

function transform(search_key) 
{
   var prerequest = 'http://open.api.sandbox.ebay.com/shopping?appid=KasselUn-efea-4b93-9505-5dc2ef1ceecd&version=517&callname=FindItems&ItemSort=EndTime&QueryKeywords=<search_key>&responseencoding=XML'; 

  prerequest = prerequest.replace(/<search_key>/g,search_key); 
 
  var request = prerequest; 

  var xmlHttp = null; 
  var respone = null; 

  xmlHttp = new XMLHttpRequest(); 

  if (xmlHttp) 
  { 
      xmlHttp.open('GET', 'http://localhost:8080/servicescreendesignerwep/requestServlet?url=http%3A%2F%2Fopen.api.sandbox.ebay.com%2Fshopping%3Fappid%3DKasselUn-efea-4b93-9505-5dc2ef1ceecd%26version%3D517%26callname%3DFindItems%26ItemSort%3DEndTime%26QueryKeywords%3DUSB%26responseencoding%3DXML', true); 
      xmlHttp.onreadystatechange = function ()
      { 
    	    var name = '';
          
            if (xmlHttp.readyState == 4) 
            { 
	            //attach xmlDoc
                var xmlResponse = xmlHttp.responseXML;

                //gets root
                var start = xmlResponse.getElementsByTagName('FindItemsResponse');
                
                //gets items
                var items = xmlResponse.getElementsByTagName('Item');
                
                  //for any item
				  for(var iCount = 0; iCount < items.length; ++iCount)
				  {
					  var itemID_Tag = items.item(iCount).getElementsByTagName('ItemID');
					  var itemID = itemID_Tag.item(0).textContent;
					  
					  var title_Tag = items.item(iCount).getElementsByTagName('Title');
					  var title = title_Tag.item(0).textContent;

					  //stellvertretend für alle transformationen
					  name += wordsFromTo(from(Trim(title), 'USB', 1), 1, 3) + ' immerhin ' + until(Trim(itemID), '0', 1) + ' || ';
				  }

          	      document.getElementById('show').value = 'name: ' + name; 
          }
      }

      
      xmlHttp.send(null); 

      return "request submitted";
  } 
 
  
}

</script>
	</head>
		<body>
			<form name=f1>
				<input type='text' name=t2 value='Harry' size='50'> 
				<input type=button value='request and transform' 
					onclick='this.form.t1.value=transform(this.form.t2.value)'>	
				<br><br><br><br> 
				RESULT:	
				<input type=text name=t1 id='show' value='press the button above..' size=200>
			</form>
		</body>
	</html>
